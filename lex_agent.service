[Unit]
Description=Lex Channel Chief Agent - AI Sales Agent for Lexful
Documentation=https://github.com/feraco/roboai-espeak
After=network.target sound.target ollama.service
Wants=ollama.service

[Service]
Type=simple
User=unitree
Group=unitree
WorkingDirectory=/home/unitree/roboai-espeak
Environment="PATH=/home/unitree/.local/bin:/usr/local/bin:/usr/bin:/bin"
Environment="SKIP_AUDIO_VALIDATION=true"
Environment="PYTHONUNBUFFERED=1"

# Audio setup before starting
ExecStartPre=/usr/bin/amixer -c 0 set Speaker unmute
ExecStartPre=/usr/bin/amixer -c 0 set Speaker 100%

# Pre-start hardware and service validation
ExecStartPre=/bin/bash /home/unitree/roboai-espeak/lex_pre_start_checks.sh

# Start the Lex agent
ExecStart=/home/unitree/.local/bin/uv run src/run.py lex_channel_chief

# Restart configuration
Restart=on-failure
RestartSec=15
StartLimitBurst=3
StartLimitIntervalSec=300

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=lex_agent

[Install]
WantedBy=multi-user.target
